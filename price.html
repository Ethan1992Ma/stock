<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>價目表查詢</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; }
    header {
      position: sticky; top: 0; background: #333; color: white;
      padding: 10px; font-size: 16px; z-index: 1000;
    }
    header .total { font-weight: bold; }
    #search { width: 100%; padding: 10px; font-size: 16px; border: none; border-bottom: 2px solid #ccc; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    .cart {
      background: #fafafa; padding: 10px; border-top: 2px solid #ccc;
    }
    .cart-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 5px 0; border-bottom: 1px solid #eee;
    }
    .cart-controls button {
      padding: 2px 6px; margin: 0 3px; font-size: 14px;
    }
  </style>
</head>
<body>

<header>
  🛒 總額：<span class="total">0</span> 元
</header>

<input type="text" id="search" placeholder="輸入品名搜尋...">

<div class="cart" id="cart">
  <h3>購物車</h3>
  <div id="cartItems"></div>
</div>

<table id="priceTable">
  <thead>
    <tr>
      <th>選擇</th>
      <th>品名</th>
      <th>價錢</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  // 你可以在這裡放完整的價目表
  const priceList = {
    "蘋果": 30,
    "香蕉": 20,
    "橘子": 25,
    "芒果": 50
  };

  const tbody = document.querySelector("#priceTable tbody");
  const search = document.querySelector("#search");
  const totalSpan = document.querySelector(".total");
  const cartItemsDiv = document.getElementById("cartItems");
  let cart = {};

  function renderTable(filter="") {
    tbody.innerHTML = "";
    Object.entries(priceList)
      .filter(([name]) => name.includes(filter))
      .forEach(([name, price]) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input type="checkbox" data-name="${name}"></td>
          <td>${name}</td>
          <td>${price}</td>
        `;
        tbody.appendChild(tr);
      });
    bindCheckboxEvents();
  }

  function bindCheckboxEvents() {
    document.querySelectorAll("input[type=checkbox]").forEach(cb => {
      cb.addEventListener("change", e => {
        const name = e.target.dataset.name;
        const price = priceList[name];
        if (e.target.checked) {
          cart[name] = (cart[name] || 0) + 1;
        } else {
          delete cart[name];
        }
        renderCart();
      });
    });
  }

  function renderCart() {
    cartItemsDiv.innerHTML = "";
    let total = 0;
    Object.entries(cart).forEach(([name, qty]) => {
      const price = priceList[name];
      const subtotal = price * qty;
      total += subtotal;
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <span>${name} (${price}元)</span>
        <div class="cart-controls">
          <button onclick="updateQty('${name}', -1)">−</button>
          <span>${qty}</span>
          <button onclick="updateQty('${name}', 1)">＋</button>
          <span> = ${subtotal}元</span>
        </div>
      `;
      cartItemsDiv.appendChild(div);
    });
    totalSpan.textContent = total;
  }

  function updateQty(name, change) {
    if (!cart[name]) return;
    cart[name] += change;
    if (cart[name] <= 0) {
      delete cart[name];
      // 取消表格中的勾選
      const cb = document.querySelector(`input[data-name="${name}"]`);
      if (cb) cb.checked = false;
    }
    renderCart();
  }

  search.addEventListener("input", e => renderTable(e.target.value));
  renderTable();
</script>

</body>
</html>
