<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>價目表查詢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 10px; }
    #cart-bar {
      position: sticky; top: 0; background: #f8f8f8; padding: 10px;
      border-bottom: 2px solid #ccc; z-index: 1000;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .name { color: blue; cursor: pointer; text-decoration: underline; }
    .cart-item { margin: 5px 0; }
    .qty-btn { cursor: pointer; margin: 0 3px; }
    /* modal */
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; padding: 20px; max-width: 90%; max-height: 80%;
      overflow-y: auto; border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="cart-bar">
    <strong>購物車總額：</strong><span id="cart-total">0</span> 元（95折已含）
    <div id="cart-list"></div>
  </div>

  <input type="text" id="search" placeholder="搜尋品名..." style="width:100%;padding:8px;">

  <table id="price-table">
    <thead>
      <tr>
        <th>選擇</th><th>品名</th><th>價錢</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>

  <!-- modal -->
  <div class="modal" id="info-modal">
    <div class="modal-content" id="modal-content"></div>
  </div>

<script>
const priceData = {
  "清燥救肺湯": 600,
  "小柴胡湯": 690,
  "六味地黃丸": 430
};

// 成分 & 適應症
const drugInfo = {
  "清燥救肺湯": {
    composition: [
      "桑葉 7.5g (Folium Mori)",
      "石膏 6.5g (Gypsum Fibrosum)",
      "甘草 2.5g (Radix et Rhizoma Glycyrrhizae)",
      "胡麻仁 2.5g (Semen Sesami)",
      "阿膠 2.0g (Colla Corii Asini)",
      "人參 2.0g (Radix et Rhizoma Ginseng Rubra)",
      "麥門冬 3.0g (Radix Ophiopogonis)",
      "杏仁 2.0g (Semen Armeniacae Amarum)",
      "枇杷葉 2.0g (Folium Eriobotryae)"
    ],
    extractRatio: "生藥 30.00g → 浸膏 6.60g（比例 4.55:1）",
    efficacy: "清燥潤肺。",
    indications: "燥邪傷肺、頭痛身熱、乾咳無痰、氣逆而喘、口渴心煩。"
  }
};

const tableBody = document.getElementById("table-body");
const cartList = document.getElementById("cart-list");
const cartTotal = document.getElementById("cart-total");
const cart = {};

function renderTable(filter="") {
  tableBody.innerHTML = "";
  for (let name in priceData) {
    if (name.includes(filter)) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="checkbox" data-name="${name}"></td>
        <td><span class="name" data-name="${name}">${name}</span></td>
        <td>${priceData[name]}</td>
      `;
      tableBody.appendChild(row);
    }
  }
}

function updateCart() {
  cartList.innerHTML = "";
  let total = 0;
  for (let name in cart) {
    let qty = cart[name];
    let price = Math.round(priceData[name] * 0.95);
    total += price * qty;
    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `
      ${name} - ${price} 元 x 
      <span class="qty-btn" data-name="${name}" data-action="minus">➖</span>
      ${qty}
      <span class="qty-btn" data-name="${name}" data-action="plus">➕</span>
      = ${price * qty} 元
    `;
    cartList.appendChild(div);
  }
  cartTotal.textContent = total;
}

// 搜尋
document.getElementById("search").addEventListener("input", e=>{
  renderTable(e.target.value.trim());
});

// 點藥名看詳細
document.body.addEventListener("click", e=>{
  if(e.target.classList.contains("name")){
    const name = e.target.dataset.name;
    const info = drugInfo[name];
    if(info){
      document.getElementById("modal-content").innerHTML = `
        <h3>${name}</h3>
        <h4>【藥物組成】</h4>
        <ul>${info.composition.map(c=>`<li>${c}</li>`).join("")}</ul>
        <p><strong>浸膏比例：</strong>${info.extractRatio}</p>
        <p><strong>效能：</strong>${info.efficacy}</p>
        <p><strong>適應症：</strong>${info.indications}</p>
        <button onclick="closeModal()">關閉</button>
      `;
      document.getElementById("info-modal").style.display = "flex";
    }
  }
});

// 勾選加入購物車
document.body.addEventListener("change", e=>{
  if(e.target.type==="checkbox"){
    const name = e.target.dataset.name;
    if(e.target.checked){
      cart[name] = 1;
    } else {
      delete cart[name];
    }
    updateCart();
  }
});

// 調整數量
document.body.addEventListener("click", e=>{
  if(e.target.classList.contains("qty-btn")){
    const name = e.target.dataset.name;
    const action = e.target.dataset.action;
    if(action==="plus") cart[name]++;
    if(action==="minus" && cart[name]>1) cart[name]--;
    updateCart();
  }
});

function closeModal(){
  document.getElementById("info-modal").style.display = "none";
}

renderTable();
</script>
</body>
</html>
