<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Breakeven & Budget Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            padding: 0;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        input, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            font-size: 1rem;
            box-sizing: border-box; /* 確保 padding 不會使元素超出可用寬度 */
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #result, #budgetResult {
            margin-top: 10px;
            font-size: 1.2rem;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stock Calculator</h1>
        <h2>Breakeven Calculator</h2>
        <label for="buyPrice">Buy Price (per share in USD):</label>
        <input type="number" id="buyPrice" placeholder="e.g., 50">
        
        <label for="shares">Number of Shares:</label>
        <input type="number" id="shares" placeholder="e.g., 100">
        
        <button onclick="calculateBreakeven()">Calculate Breakeven Price</button>
        <div id="result"></div>

        <h2>Investment Budget Calculator</h2>
        <label for="buyPriceBudget">Buy Price (per share in USD):</label>
        <input type="number" id="buyPriceBudget" placeholder="e.g., 50">
        
        <label for="budget">Investment Budget (in TWD):</label>
        <input type="number" id="budget" placeholder="e.g., 100000">
        
        <label for="exchangeRate">Exchange Rate (TWD to USD, default: 32):</label>
        <input type="number" id="exchangeRate" placeholder="e.g., 30.5 (optional)">
        
        <button onclick="calculateBudget()">Calculate Purchase Details</button>
        <div id="budgetResult"></div>
    </div>

    <script>
        function calculateBreakeven() {
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const shares = parseInt(document.getElementById('shares').value);
            const feePerTransaction = 3; 
            const sellingFeeRate = 0.00278;

            if (isNaN(buyPrice) || isNaN(shares)) {
                document.getElementById('result').innerText = "Please enter valid values.";
                return;
            }

            const totalCost = (buyPrice * shares) + feePerTransaction;
            const breakevenPrice = (totalCost + feePerTransaction) / (shares * (1 - sellingFeeRate));

            document.getElementById('result').innerText = `Breakeven Selling Price: $${breakevenPrice.toFixed(2)} per share`;
        }

        function calculateBudget() {
            const buyPriceBudget = parseFloat(document.getElementById('buyPriceBudget').value);
            const budget = parseFloat(document.getElementById('budget').value);
            let exchangeRate = parseFloat(document.getElementById('exchangeRate').value);

            if (isNaN(exchangeRate) || exchangeRate <= 0) {
                exchangeRate = 32; // 預設匯率
            }

            const feePerTransaction = 3; // 每次交易 $3 手續費

            if (isNaN(buyPriceBudget) || isNaN(budget)) {
                document.getElementById('budgetResult').innerText = "Please enter valid values.";
                return;
            }

            // 1. 計算可使用的美金預算（扣掉買入手續費）
            const usdBudget = budget / exchangeRate; // 台幣預算轉美金
            const availableBudget = usdBudget - feePerTransaction; // 扣掉買入手續費後的美金預算

            // 2. 計算可購買的股數
            const maxShares = Math.floor(availableBudget / buyPriceBudget);

            // 3. 計算最終總花費 (買入股數花費 + 手續費)
            const totalCostUSD = (maxShares * buyPriceBudget) + feePerTransaction;
            const totalCostTWD = totalCostUSD * exchangeRate;

            // 4. 顯示結果
            document.getElementById('budgetResult').innerText = `
                You can buy ${maxShares} shares.
                Total Cost (including fee): $${totalCostUSD.toFixed(2)} USD (${totalCostTWD.toFixed(0)} TWD).
            `;
        }
    </script>
</body>
</html>
